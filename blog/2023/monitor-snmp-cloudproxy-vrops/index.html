<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <p>วันนี้เราจะมาสอนวิธีการติดตั้ง Cloud Proxy บน vROps เพื่อไป Monitor Host machine ด้วย Protocol SNMP ( Simple Network Management Protocol )</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*upiZOKAi_b12FgHaj96gFQ.png"><figcaption>vRealize Operations UI</figcaption></figure> <p>ก่อนอื่นเรามาทำความเข้าใจ Protocol SNMP กันก่อน</p> <p><strong>Simple Network Management Protocol (SNMP)</strong></p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/404/0*zj_8t0tG_-t0WOSX"><figcaption>OSI Model</figcaption></figure> <p>SNMP เป็น Protocol ที่ Layer 7 ( Application Layer ) ในชุด TCP/IP (Transmission Control Protocol/Internet Protocol ) ซึ่ง Protocol SNMP สามารถใช้ในการ Monitor และ Manage network devices จาก IP เราสามารถใช้ Protocol นี้ในการจัดการอุปกรณ์ Router, Switch, Firewall หรือ Server ต่างๆ ที่อยู่ใน Network.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*OnZ4tKM5y9QQMBD4KtPKWQ.png"><figcaption>Host-Resource MIB Example</figcaption></figure> <p>มีการใช้ MIB ( Management Information Base ) ในการเก็บหรือจัดการค่าต่างๆของอุปกรณ์ใน Network โดยจะจัดเก็บอยู่ในรูปแบบ Hierarchical format.</p> <p>ใน 1 MIB สามารถใช้ในการ Manage ได้หลาย Object โดนเราสามารถระบุ OID (Object Identifier) เพื่อทำการแยก variable ต่างๆใน MIB Hierarchy ได้ ซึ่งเลข OID แต่ละตัวก็จะต่างกันในแต่ละ Vendor / Devices</p> <p>เช่น OID 1.3.6.1.2.1.25.3.2.1 สามารถใช้ในการ​ Monitor hrDeviceIndex</p> <pre>iso (1) <br>.org (3) <br>.dod (6) <br>.internet (1) <br>.mgmt (2)<br>.mib-2 (1) <br>.host (25) <br>.hrDevice (3) <br>.hrDeviceTable (2)<br>.hrDeviceEntry (1)<br>.hrDeviceIndex (1) </pre> <p><strong>Port ที่ใช้งาน</strong></p> <p>SNMP ใช้การสื่อสารแบบ UDP ( User Datagram Protocol ) ที่ Port 161/162</p> <p><strong>สามารถอ่านต่อได้ที่</strong></p> <p><a href="https://www.comparitech.com/net-admin/snmp-mibs-oids-explained/" rel="external nofollow noopener" target="_blank">SNMP MIBs &amp; SNMP OIDs Explained - SNMP Architecture Guide</a></p> <h3><strong>Cloud Proxy</strong></h3> <p>ใน vROps เราสามารถใช้ Cloud Proxy ในการเก็บข้อมูลและ Monitor จาก Remote Data Center และส่งข้อมูลกลับไปที่ vRealize Operations. โดยปกติแล้วเราจะใช้ Cloud Proxy เพียง 1 ตัว ต่อ 1 Physical Data Center</p> <p><strong>Cloud Proxy Installation</strong></p> <ol><li>Login ไปที่ vRealize Operations</li></ol> <p>2. เลือก Data Sources -&gt; Cloud Proxies กดที่ New</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*RqBsEZjfGgG4UlCpvkBwCg.png"></figure> <p>3. เลือก Download Cloud Proxy OVA และทำการ Save OVA ไว้ที่เครื่อง Local</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*2SxGP2j7ctX-WoCzazt3Kg.png"></figure> <p>4. ที่หน้า vSphere Client เลือกที่ Cluster หรือ Folder ของเราที่ต้องการ Deploy Cloud Proxy แล้วกด Deploy OVF Template</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*acf20aulXWeEIBqcvv5ULg.png"></figure> <p>5. ตั้งค่า Name, Folder และ Resource Pool</p> <p>6. ในส่วน Configuration ให้เลือกขนาดของ Cloud Proxy ให้เหมาะกับ Resource หรือจำนวน VM ที่ต้องการ Monitor</p> <blockquote>Small Cloud Proxy สำหรับ &lt;8000 VMs จะใช้ 2 vCPUs และ Ram 8GB</blockquote> <blockquote>Standard Cloud Proxy สำหรับระหว่าง 8000–40000 VMs จะใช้ 4 vCPUs และ Ram 32GB</blockquote> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*8fp0MFlgAnq2Xw6LekVRUQ.png"></figure> <p>7. ในส่วนของการ Customize Template ทำการ Copy One Time Key จากขั้นตอนที่ 3 จาก vRealize Operations มาใส่</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*VMVysLaPiSvykfkkLmAcNg.png"></figure> <p>8. หลังจากใส่ Name, NTP Server ให้กด Finish เพื่อทำการสร้าง Cloud Proxy vApps</p> <p>9. ในหน้า vSphere Client ทำการ Power-on VM</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*PukNLnB38TsS0_Lk861w0g.png"></figure> <p>หลังจากทำการ Power-on Cloud Proxy VM และ VM ทำการ Initialize สามารถไปดู Cloud Proxy ที่เพิ่งถูกสร้างขึ้นใน vRealize Operations โดยเลือกไปที่ Data Sources -&gt; Cloud Proxies</p> <h3>SNMP Adapter</h3> <p>เราสามารถ Download Management Packs มาใส่ให้ vROps เพื่อเพิ่มความสามารถในการ Monitor, Troubleshooting และ Remediation ของตัว SDDC.</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*s-rfQR59Ka0y4nHzJr2ZIg.png"><figcaption>VMware Marketplace SNMP Adapter</figcaption></figure> <p>โดยในส่วนของ SNMP Adapter จะใช้ชื่อว่า VMware vRealize Operations Management Pack for SNMP ( ในตัวอย่างเป็น Version 3.2.1 ) สามารถ Download ได้จาก <a href="https://marketplace.vmware.com" rel="external nofollow noopener" target="_blank">VMware Marketplace</a></p> <p><a href="https://marketplace.cloud.vmware.com/" rel="external nofollow noopener" target="_blank">VMware Marketplace</a></p> <p><strong>SNMP Adapter Installation</strong></p> <ol> <li>เข้าไปที่ <a href="https://marketplace.vmware.com" rel="external nofollow noopener" target="_blank">VMware Marketplace</a> และ Download ไฟล์ PAK Management Pack ของ SNMP</li> <li>เข้าไปที่ Data Sources -&gt; Integrations แล้วกด ADD ใน Tab Repository</li> </ol> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*BCGagkqPe3mva-wgvAjr6Q.png"></figure> <p>3. ทำการ Browse และ Upload ไฟล์ .PAK แล้วทำการ Accept EULA แล้วกด Finish</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*wKWaRtohWu4tGqEwcyOHow.png"></figure> <p><strong>SNMP Adapter Configuration</strong></p> <ol> <li>เข้าไปที่ Data Sources -&gt; Integrations แล้วกด Add Account</li> <li>เลือก SNMP Adapter เพื่อสร้าง Adapter</li> </ol> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*s9FqV4vY3MSqcG0ekNM4MA.png"></figure> <p>3. ทำการใส่ IP ของ Device ที่ต้องการ Monitor โดยสามารถกำหนดเป็น Range ของ IP</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*4DouO1Z3g71lUzfFibFwVQ.png"></figure> <p>4. ในส่วนของ Credentials สามารถเลือกได้ทั้ง SNMPv2c และ SNMPv3 และใส่ Credentials รวมถึง Protocol ที่ใช้ในการ Authenticate</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*ur9HH8Cv1gVeHP8U--YheA.png"></figure> <p>5. สามารถกด Validate Connection เพื่อทดสอบการเชื่อมต่อกับ Network Device ได้ แล้วกด ADD เพื่อทำการสร้าง Adapter</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*Leb5az2TcWFWaYKrR2R_UA.png"></figure> <p>6. ไปที่ Environment -&gt; Object Browser และเลือก SNMP Adapter เพื่อทำการ Monitor Device ต่างๆ หรือทำการ Create Dashboard ได้</p> <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*aqJKu75mUu_uZQ5IgXCeaw.png"></figure> <p><strong>More Information: </strong><a href="https://docs.vmware.com/en/vRealize-Operations/index.html" rel="external nofollow noopener" target="_blank">https://docs.vmware.com/en/vRealize-Operations/index.html</a></p> <ul> <li><a href="https://docs.vmware.com/en/Management-Packs-for-vRealize-Operations/index.html" rel="external nofollow noopener" target="_blank">Management Packs for vRealize Operations Documentation</a></li> <li><a href="https://marketplace.cloud.vmware.com/services/details/vrealize-operations-management-pack-for-snmp-3-2-1-11?slug=true" rel="external nofollow noopener" target="_blank">VMware Marketplace</a></li> </ul> <p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=8177fd9da253" width="1" height="1" alt=""></p> </body></html>